{% extends 'base.html' %}

{% block title %}Мои проекты{% endblock %}

{% block content %}
    <h2 class="text-center mb-4">Мои проекты</h2>

<form method="get" class="mb-3 d-flex gap-2 position-relative">
    <!-- Поле поиска -->
    <input type="text" name="search" id="searchInput" class="form-control" placeholder="Поиск по названию проекта" value="{{ request.GET.search }}">

    <!-- Кнопка очистки (крестик) -->
    <button type="button" id="clearSearch" class="btn btn-outline-secondary" style="display: none;">
        <i class="bi bi-x-circle"></i>
    </button>

    <!-- Кнопка поиска -->
    <button type="submit" class="btn btn-primary">
        <i class="bi bi-search"></i>
    </button>
</form>

<script>
document.addEventListener("DOMContentLoaded", function () {
    let searchInput = document.getElementById("searchInput");
    let clearButton = document.getElementById("clearSearch");

    // Показываем кнопку очистки, если есть текст в поле поиска
    function toggleClearButton() {
        clearButton.style.display = searchInput.value.length > 0 ? "inline-block" : "none";
    }

    // Очистка поиска
    clearButton.addEventListener("click", function () {
        searchInput.value = "";
        document.querySelector("form").submit(); // Отправляем форму после очистки
    });

    // Проверяем состояние при загрузке страницы
    toggleClearButton();

    // Отслеживаем ввод текста
    searchInput.addEventListener("input", toggleClearButton);
});
</script>


    {% if search_query %}
        <div class="alert alert-info text-center">
            Результаты поиска по запросу: <strong>{{ search_query }}</strong>
        </div>
    {% endif %}

    {% if projects %}
        <div class="row">
            {% for project in projects %}
                <div class="col-md-6 mb-4">
                    <div class="card shadow-lg border-6">
                        <div class="card-body position-relative">
                            <h5 class="card-title d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center gap-2">
                                    <img src="{{ project.data_base_name.images_db.url }}" alt="{{ project.data_base_name.name }}" style="width: 40px; height: 40px; object-fit: contain;">
                                    <span>{{ project.db_project }} (БД: {{ project.data_base_name }})</span>
                                </div>
                            </h5>
                            <hr>
                            <p><strong>Дата создания:</strong> {{ project.db_date_create|date:"d.m.Y - H:i" }}</p>
                            <p><strong>Дата изменения:</strong> {{ project.db_date_edit|date:"d.m.Y - H:i" }}</p>
                            
                            <div class="d-flex justify-content-end gap-3">
                                <a href="{% url 'connect_to_database' project.pk %}" class="btn btn-success"> <i class="bi bi-database"></i> Подключиться</a>
                                <a href="{% url 'database_edit' project.pk %}" class="btn btn-success"> <i class="bi bi-gear-fill"></i> Настройки</a>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-warning text-center">
            {% if search_query %}
                По запросу <strong>"{{ search_query }}"</strong> ничего не найдено.
            {% else %}
                У вас нет созданных проектов.
            {% endif %}
        </div>
    {% endif %}

    <div class="d-flex justify-content-between mt-3">
        <a href="{% url 'home' %}" class="btn btn-secondary"> <i class="bi bi-arrow-left"></i> Назад </a>
        <a href="{% url 'create_project' %}" class="btn btn-success"> <i class="bi bi-plus-lg"></i> Создать проект </a>
    </div>
{% endblock %}
